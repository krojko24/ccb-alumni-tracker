<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>CCB Alumni Tracker</title>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Barlow:ital,wght@0,400;0,600;0,700;1,400&family=Barlow+Condensed:wght@400;600;700&display=swap" rel="stylesheet" />
  <style>
    :root {
      --navy:   #0a0e1a;
      --navy2:  #111827;
      --navy3:  #1c2740;
      --gold:   #c9a84c;
      --gold2:  #e8c46a;
      --green:  #2e7d4f;
      --green2: #3fa066;
      --white:  #f0f4ff;
      --muted:  #8a95b0;
      --border: rgba(201,168,76,0.18);
      --card:   rgba(28,39,64,0.7);
    }

    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

    body {
      background: var(--navy);
      color: var(--white);
      font-family: 'Barlow', sans-serif;
      min-height: 100vh;
      overflow-x: hidden;
    }

    /* ── Background texture ── */
    body::before {
      content: '';
      position: fixed;
      inset: 0;
      background:
        radial-gradient(ellipse 80% 60% at 20% 10%, rgba(46,125,79,0.07) 0%, transparent 60%),
        radial-gradient(ellipse 60% 50% at 80% 80%, rgba(201,168,76,0.05) 0%, transparent 60%);
      pointer-events: none;
      z-index: 0;
    }

    /* ── Header ── */
    header {
      position: relative;
      z-index: 1;
      padding: 56px 32px 40px;
      text-align: center;
      border-bottom: 1px solid var(--border);
    }

    .header-eyebrow {
      font-family: 'Barlow Condensed', sans-serif;
      font-size: 12px;
      font-weight: 600;
      letter-spacing: 4px;
      text-transform: uppercase;
      color: var(--gold);
      margin-bottom: 12px;
    }

    header h1 {
      font-family: 'Bebas Neue', sans-serif;
      font-size: clamp(48px, 8vw, 88px);
      letter-spacing: 3px;
      line-height: 1;
      color: var(--white);
    }

    header h1 span {
      color: var(--gold);
    }

    .header-sub {
      margin-top: 14px;
      font-size: 15px;
      color: var(--muted);
      font-weight: 400;
    }

    .last-updated {
      display: inline-block;
      margin-top: 18px;
      font-family: 'Barlow Condensed', sans-serif;
      font-size: 12px;
      letter-spacing: 2px;
      text-transform: uppercase;
      color: var(--muted);
      background: rgba(255,255,255,0.04);
      border: 1px solid var(--border);
      padding: 6px 16px;
      border-radius: 4px;
    }

    /* ── Main layout ── */
    main {
      position: relative;
      z-index: 1;
      max-width: 1280px;
      margin: 0 auto;
      padding: 48px 24px 80px;
    }

    /* ── Section headers ── */
    .section-header {
      display: flex;
      align-items: center;
      gap: 20px;
      margin-bottom: 28px;
      margin-top: 64px;
    }

    .section-header:first-child { margin-top: 0; }

    .section-title {
      font-family: 'Bebas Neue', sans-serif;
      font-size: 36px;
      letter-spacing: 2px;
      color: var(--white);
    }

    .section-pill {
      font-family: 'Barlow Condensed', sans-serif;
      font-size: 11px;
      font-weight: 600;
      letter-spacing: 2px;
      text-transform: uppercase;
      padding: 4px 12px;
      border-radius: 3px;
      background: var(--green);
      color: #fff;
    }

    .section-pill.pro { background: var(--gold); color: var(--navy); }

    .section-line {
      flex: 1;
      height: 1px;
      background: var(--border);
    }

    /* ── Filter bar ── */
    .filter-bar {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
      margin-bottom: 20px;
    }

    .filter-btn {
      font-family: 'Barlow Condensed', sans-serif;
      font-size: 12px;
      font-weight: 600;
      letter-spacing: 1.5px;
      text-transform: uppercase;
      padding: 6px 16px;
      border-radius: 3px;
      border: 1px solid var(--border);
      background: transparent;
      color: var(--muted);
      cursor: pointer;
      transition: all 0.15s;
    }

    .filter-btn:hover,
    .filter-btn.active {
      background: var(--gold);
      border-color: var(--gold);
      color: var(--navy);
    }

    /* ── Table ── */
    .table-wrap {
      overflow-x: auto;
      border-radius: 8px;
      border: 1px solid var(--border);
    }

    table {
      width: 100%;
      border-collapse: collapse;
      font-size: 14px;
    }

    thead tr {
      background: rgba(201,168,76,0.08);
      border-bottom: 1px solid var(--border);
    }

    thead th {
      font-family: 'Barlow Condensed', sans-serif;
      font-size: 11px;
      font-weight: 600;
      letter-spacing: 1.5px;
      text-transform: uppercase;
      color: var(--gold);
      padding: 12px 16px;
      text-align: left;
      white-space: nowrap;
    }

    thead th.num { text-align: center; }

    tbody tr {
      border-bottom: 1px solid rgba(255,255,255,0.04);
      transition: background 0.12s;
    }

    tbody tr:last-child { border-bottom: none; }

    tbody tr:hover { background: rgba(201,168,76,0.05); }

    tbody td {
      padding: 13px 16px;
      vertical-align: middle;
      white-space: nowrap;
    }

    tbody td.num {
      text-align: center;
      font-family: 'Barlow Condensed', sans-serif;
      font-size: 15px;
      color: var(--white);
    }

    /* Player name cell */
    .player-name {
      font-weight: 700;
      font-size: 15px;
      color: var(--white);
    }

    .player-team {
      font-size: 12px;
      color: var(--muted);
      margin-top: 2px;
    }

    /* Level badge */
    .level-badge {
      display: inline-block;
      font-family: 'Barlow Condensed', sans-serif;
      font-size: 10px;
      font-weight: 700;
      letter-spacing: 1px;
      padding: 2px 8px;
      border-radius: 3px;
      text-transform: uppercase;
    }

    .level-D1  { background: rgba(201,168,76,0.15); color: var(--gold2); border: 1px solid rgba(201,168,76,0.3); }
    .level-D2  { background: rgba(46,125,79,0.15);  color: var(--green2); border: 1px solid rgba(46,125,79,0.3); }
    .level-D3  { background: rgba(46,125,79,0.1);   color: var(--green2); border: 1px solid rgba(46,125,79,0.2); }
    .level-NAIA{ background: rgba(100,150,255,0.1); color: #90b4ff;       border: 1px solid rgba(100,150,255,0.2); }
    .level-JC  { background: rgba(255,255,255,0.06);color: var(--muted);  border: 1px solid rgba(255,255,255,0.1); }
    .level-PRO { background: rgba(201,168,76,0.2);  color: var(--gold);   border: 1px solid var(--gold); }

    /* Type badge */
    .type-badge {
      font-family: 'Barlow Condensed', sans-serif;
      font-size: 10px;
      font-weight: 600;
      letter-spacing: 1px;
      text-transform: uppercase;
      color: var(--muted);
    }

    /* ── Sub-section headers (Hitters / Pitchers) ── */
    .sub-section-header {
      display: flex;
      align-items: center;
      gap: 14px;
      margin-bottom: 14px;
      margin-top: 28px;
    }

    .sub-section-title {
      font-family: 'Barlow Condensed', sans-serif;
      font-size: 13px;
      font-weight: 700;
      letter-spacing: 3px;
      text-transform: uppercase;
      color: var(--muted);
      white-space: nowrap;
    }

    /* ── Sortable column headers ── */
    thead th.sortable {
      cursor: pointer;
      user-select: none;
      position: relative;
      transition: color 0.15s;
    }
    thead th.sortable:hover { color: var(--gold2); }
    thead th.sort-asc::after  { content: ' ▲'; font-size: 9px; color: var(--gold); }
    thead th.sort-desc::after { content: ' ▼'; font-size: 9px; color: var(--gold); }

    /* Stat highlight — top values */
    .stat-highlight { color: var(--gold2); font-weight: 700; }

    /* Empty state */
    .empty-state {
      text-align: center;
      padding: 60px 20px;
      color: var(--muted);
      font-family: 'Barlow Condensed', sans-serif;
      font-size: 14px;
      letter-spacing: 1px;
    }

    /* ── Footer ── */
    footer {
      position: relative;
      z-index: 1;
      text-align: center;
      padding: 24px;
      border-top: 1px solid var(--border);
      font-family: 'Barlow Condensed', sans-serif;
      font-size: 12px;
      letter-spacing: 1px;
      color: var(--muted);
    }

    /* ── Responsive ── */
    @media (max-width: 640px) {
      header { padding: 36px 20px 28px; }
      main { padding: 32px 16px 60px; }
      .hide-mobile { display: none; }
    }
  </style>
</head>
<body>

<header>
  <div class="header-eyebrow">Cal Club Baseball</div>
  <h1>Alumni <span>Tracker</span></h1>
  <p class="header-sub">Follow our former players at every level of the game</p>
  <span class="last-updated" id="lastUpdated">Loading stats...</span>
</header>

<main>

  <!-- ── COLLEGE SECTION ── -->
  <div class="section-header">
    <h2 class="section-title">College</h2>
    <span class="section-pill">NCAA · NAIA · JC</span>
    <div class="section-line"></div>
  </div>

  <div class="filter-bar" id="collegeFilters">
    <button class="filter-btn active" data-filter="all">All Levels</button>
    <button class="filter-btn" data-filter="D1">D1</button>
    <button class="filter-btn" data-filter="D2">D2</button>
    <button class="filter-btn" data-filter="D3">D3</button>
    <button class="filter-btn" data-filter="NAIA">NAIA</button>
    <button class="filter-btn" data-filter="JC">JC</button>
  </div>

  <div class="sub-section-header">
    <span class="sub-section-title">Hitters</span>
    <div class="section-line"></div>
  </div>
  <div class="table-wrap">
    <table id="collegeHitTable">
      <thead id="collegeHitHead"></thead>
      <tbody id="collegeHitBody"><tr><td colspan="20"><div class="empty-state">Loading...</div></td></tr></tbody>
    </table>
  </div>

  <div class="sub-section-header" style="margin-top:36px;">
    <span class="sub-section-title">Pitchers</span>
    <div class="section-line"></div>
  </div>
  <div class="table-wrap">
    <table id="collegePitTable">
      <thead id="collegePitHead"></thead>
      <tbody id="collegePitBody"><tr><td colspan="20"><div class="empty-state">Loading...</div></td></tr></tbody>
    </table>
  </div>

  <!-- ── PRO SECTION ── -->
  <div class="section-header">
    <h2 class="section-title">Professional</h2>
    <span class="section-pill pro">MLB · MiLB</span>
    <div class="section-line"></div>
  </div>

  <div class="sub-section-header">
    <span class="sub-section-title">Hitters</span>
    <div class="section-line"></div>
  </div>
  <div class="table-wrap">
    <table id="proHitTable">
      <thead id="proHitHead"></thead>
      <tbody id="proHitBody"><tr><td colspan="20"><div class="empty-state">Pro season stats will appear here once the season begins.</div></td></tr></tbody>
    </table>
  </div>

  <div class="sub-section-header" style="margin-top:36px;">
    <span class="sub-section-title">Pitchers</span>
    <div class="section-line"></div>
  </div>
  <div class="table-wrap">
    <table id="proPitTable">
      <thead id="proPitHead"></thead>
      <tbody id="proPitBody"><tr><td colspan="20"><div class="empty-state">Pro season stats will appear here once the season begins.</div></td></tr></tbody>
    </table>
  </div>

</main>

<footer>
  Stats updated automatically · Cal Club Baseball Alumni Tracker
</footer>

<script>
// ─────────────────────────────────────────────────────────────────────────────
// CONFIG — update these URLs to point to your published Google Sheet CSVs
// After uploading to Google Sheets: File → Share → Publish to web → CSV
// ─────────────────────────────────────────────────────────────────────────────
const COLLEGE_CSV_URL = "https://krojko24.github.io/ccb-alumni-tracker/college_stats.csv";
const PRO_CSV_URL     = "https://krojko24.github.io/ccb-alumni-tracker/pro_stats.csv";

// ─────────────────────────────────────────────────────────────────────────────

// College hitting columns to display
const COL_HIT_COLS = [
  {key:"AVG",label:"AVG",num:true},
  {key:"GP", label:"GP", num:true},
  {key:"AB", label:"AB", num:true},
  {key:"R",  label:"R",  num:true},
  {key:"H",  label:"H",  num:true},
  {key:"2B", label:"2B", num:true},
  {key:"3B", label:"3B", num:true},
  {key:"HR", label:"HR", num:true},
  {key:"RBI",label:"RBI",num:true},
  {key:"BB", label:"BB", num:true},
  {key:"K",  label:"K",  num:true},
  {key:"OBP",label:"OBP",num:true},
  {key:"SLG",label:"SLG",num:true},
  {key:"SB", label:"SB", num:true},
];

const COL_PIT_COLS = [
  {key:"ERA", label:"ERA", num:true},
  {key:"W",   label:"W",   num:true},
  {key:"L",   label:"L",   num:true},
  {key:"APP", label:"APP", num:true},
  {key:"GS_P",label:"GS",  num:true},
  {key:"SV",  label:"SV",  num:true},
  {key:"IP",  label:"IP",  num:true},
  {key:"H_P", label:"H",   num:true},
  {key:"BB_P",label:"BB",  num:true},
  {key:"K_P", label:"K",   num:true},
  {key:"ER",  label:"ER",  num:true},
  {key:"WHIP",label:"WHIP",num:true},
];

const PRO_HIT_COLS = [
  {key:"AVG",label:"AVG",num:true},
  {key:"G",  label:"G",  num:true},
  {key:"AB", label:"AB", num:true},
  {key:"R",  label:"R",  num:true},
  {key:"H",  label:"H",  num:true},
  {key:"2B", label:"2B", num:true},
  {key:"3B", label:"3B", num:true},
  {key:"HR", label:"HR", num:true},
  {key:"RBI",label:"RBI",num:true},
  {key:"BB", label:"BB", num:true},
  {key:"SO", label:"K",  num:true},
  {key:"OBP",label:"OBP",num:true},
  {key:"SLG",label:"SLG",num:true},
  {key:"OPS",label:"OPS",num:true},
  {key:"SB", label:"SB", num:true},
];

const PRO_PIT_COLS = [
  {key:"ERA",  label:"ERA", num:true},
  {key:"W",    label:"W",   num:true},
  {key:"L",    label:"L",   num:true},
  {key:"G_P",  label:"G",   num:true},
  {key:"GS_P", label:"GS",  num:true},
  {key:"SV",   label:"SV",  num:true},
  {key:"IP",   label:"IP",  num:true},
  {key:"H_P",  label:"H",   num:true},
  {key:"BB_P", label:"BB",  num:true},
  {key:"SO_P", label:"K",   num:true},
  {key:"ER",   label:"ER",  num:true},
  {key:"WHIP", label:"WHIP",num:true},
];

// ── CSV parser ────────────────────────────────────────────────────────────────
function parseCSV(text) {
  const lines = text.trim().split("\n");
  const headers = lines[0].split(",").map(h => h.trim().replace(/\r/g, ""));
  return lines.slice(1).map(line => {
    const vals = line.split(",");
    const obj = {};
    headers.forEach((h, i) => obj[h] = (vals[i] || "").trim().replace(/\r/g, ""));
    return obj;
  });
}

// ── Sort state + row cache (avoids storing JSON in DOM attributes) ───────────
const sortState = {};
const rowCache  = {}; // bodyId -> rows array

function lastName(name) {
  const parts = (name || '').trim().split(' ');
  return parts[parts.length - 1].toLowerCase();
}

function sortRows(rows, key, dir) {
  return [...rows].sort((a, b) => {
    if (key === 'Name') {
      const la = lastName(a.Name), lb = lastName(b.Name);
      return dir === 'asc' ? la.localeCompare(lb) : lb.localeCompare(la);
    }
    const va = parseFloat(a[key]) || 0;
    const vb = parseFloat(b[key]) || 0;
    return dir === 'asc' ? va - vb : vb - va;
  });
}

function buildRows(sorted, cols, isCollege) {
  return sorted.map(r => {
    const baseColsHtml = isCollege
      ? `<td>
           <div class="player-name">${r.BioURL
             ? `<a href="${r.BioURL}" target="_blank" rel="noopener" style="color:inherit;text-decoration:none;border-bottom:1px solid rgba(201,168,76,0.4);padding-bottom:1px;transition:border-color 0.15s;" onmouseover="this.style.borderColor='var(--gold)'" onmouseout="this.style.borderColor='rgba(201,168,76,0.4)'">${r.Name || ''}</a>`
             : r.Name || ''}</div>
           <div class="player-team">${r.Team || ''}</div>
         </td>
         <td><span class="level-badge level-${r.Level}">${r.Level || ''}</span></td>
         <td><span class="type-badge">${r.Position || ''}</span></td>`
      : `<td>
           <div class="player-name">${r.BioURL
             ? `<a href="${r.BioURL}" target="_blank" rel="noopener" style="color:inherit;text-decoration:none;border-bottom:1px solid rgba(201,168,76,0.4);padding-bottom:1px;transition:border-color 0.15s;" onmouseover="this.style.borderColor='var(--gold)'" onmouseout="this.style.borderColor='rgba(201,168,76,0.4)'">${r.Name || ''}</a>`
             : r.Name || ''}</div>
           <div class="player-team">${r.Team || ''}</div>
         </td>
         <td style="color:var(--muted);font-size:13px">${r.Org || ''}</td>
         <td style="color:var(--muted);font-size:13px">${r.League || ''}</td>
         <td><span class="type-badge">${r.Position || ''}</span></td>`;

    const statCols = cols.map(c => {
      const val = r[c.key] || '—';
      const isHighlight = (c.key === 'AVG'  && parseFloat(val) >= 0.350)
                       || (c.key === 'HR'   && parseInt(val)   >= 5)
                       || (c.key === 'ERA'  && parseFloat(val) <= 2.50 && val !== '—')
                       || (c.key === 'OPS'  && parseFloat(val) >= 0.900)
                       || (c.key === 'WHIP' && parseFloat(val) <= 1.10 && val !== '—');
      return `<td class="num ${isHighlight ? 'stat-highlight' : ''}">${val}</td>`;
    }).join('');

    return `<tr>${baseColsHtml}${statCols}</tr>`;
  }).join('');
}

function buildHead(headId, bodyId, cols, isCollege, key, dir) {
  const s = (colKey) => {
    const active = key === colKey;
    const cls = active ? (dir === 'asc' ? ' sort-asc' : ' sort-desc') : '';
    return `class="sortable${cls}" data-head="${headId}" data-body="${bodyId}" data-key="${colKey}"`;
  };
  const playerTh = `<th ${s('Name')}>Player</th>`;
  const baseThs  = isCollege
    ? playerTh + `<th>Lvl</th><th>Pos</th>`
    : playerTh + `<th>Org</th><th>League</th><th>Pos</th>`;
  const statThs  = cols.map(c =>
    `<th ${s(c.key)} class="num sortable${key===c.key?(dir==='asc'?' sort-asc':' sort-desc'):''}"
      data-head="${headId}" data-body="${bodyId}" data-key="${c.key}">${c.label}</th>`
  ).join('');
  return `<tr>${baseThs}${statThs}</tr>`;
}

// ── Render a single sub-table (hitters OR pitchers) ─────────────────────────
function renderSubTable(headId, bodyId, rows, cols, isCollege, emptyMsg) {
  const thead = document.getElementById(headId);
  const tbody = document.getElementById(bodyId);

  if (!rows.length) {
    thead.innerHTML = '';
    tbody.innerHTML = `<tr><td colspan="20"><div class="empty-state">${emptyMsg}</div></td></tr>`;
    return;
  }

  // Cache rows for sort handler
  rowCache[bodyId]   = { rows, cols, isCollege };
  if (!sortState[bodyId]) sortState[bodyId] = { key: 'Name', dir: 'asc' };
  const { key, dir } = sortState[bodyId];

  thead.innerHTML = buildHead(headId, bodyId, cols, isCollege, key, dir);
  tbody.innerHTML = buildRows(sortRows(rows, key, dir), cols, isCollege);
}

// ── Render all four sub-tables for a given level filter ───────────────────────
function renderAll(levelFilter) {
  const cf = levelFilter === 'all'
    ? collegeData
    : collegeData.filter(r => r.Level === levelFilter);

  const hasPlayed = r => {
    const gp  = parseInt(r.GP  || r.APP || '0');
    return gp > 0;
  };

  renderSubTable('collegeHitHead','collegeHitBody',
    cf.filter(r => r.Type === 'Hitting'  && hasPlayed(r)), COL_HIT_COLS, true,
    'No hitters found for this level.');
  renderSubTable('collegePitHead','collegePitBody',
    cf.filter(r => r.Type === 'Pitching' && hasPlayed(r)), COL_PIT_COLS, true,
    'No pitchers found for this level.');
  renderSubTable('proHitHead','proHitBody',
    proData.filter(r => r.Type === 'Hitting'), PRO_HIT_COLS, false,
    'Pro season stats will appear here once the season begins.');
  renderSubTable('proPitHead','proPitBody',
    proData.filter(r => r.Type === 'Pitching'), PRO_PIT_COLS, false,
    'Pro season stats will appear here once the season begins.');
}

// ── Filter logic ──────────────────────────────────────────────────────────────
let collegeData = [], proData = [];

function filterTable(section, filter, btn) {
  document.querySelectorAll('#collegeFilters .filter-btn').forEach(b => b.classList.remove('active'));
  btn.classList.add('active');
  renderAll(filter);
}

// ── Load CSVs ─────────────────────────────────────────────────────────────────
async function fetchCSV(url) {
    const res = await fetch(url);
    if (!res.ok) throw new Error(`Failed to fetch ${url}: ${res.status}`);
    return await res.text();
}

async function loadData() {
  try {
    // College
    const text = await fetchCSV(COLLEGE_CSV_URL);
    if (text) {
      collegeData = parseCSV(text);
      renderAll('all');

      // Show last updated date
      if (collegeData.length) {
        const date = collegeData[0]['Last Updated'] || '';
        if (date) {
          document.getElementById('lastUpdated').textContent = `Stats as of ${date}`;
        }
      }
    } else {
      throw new Error('College CSV not found');
    }
  } catch(e) {
    document.getElementById('collegeBody').innerHTML =
      `<tr><td colspan="20"><div class="empty-state">
        Configure your CSV URL in the page settings to display stats.
      </div></td></tr>`;
    document.getElementById('lastUpdated').textContent = 'Stats not yet configured';
  }

  try {
    // Pro
    const proText = await fetchCSV(PRO_CSV_URL);
    if (proText) {
      const text = proText;
      proData = parseCSV(text);
      renderAll('all');
    }
  } catch(e) {
    document.getElementById('proBody').innerHTML =
      `<tr><td colspan="20"><div class="empty-state">Pro season stats will appear here once the season begins.</div></td></tr>`;
  }
}

// ── Event delegation for sortable column headers ─────────────────────────────
document.addEventListener('click', function(e) {
  const th = e.target.closest('th.sortable');
  if (!th) return;
  const headId = th.dataset.head;
  const bodyId = th.dataset.body;
  const key    = th.dataset.key;
  if (!headId || !bodyId || !key) return;

  const prev = sortState[bodyId] || { key: 'Name', dir: 'asc' };
  const dir  = (prev.key === key && prev.dir === 'asc') ? 'desc' : 'asc';
  sortState[bodyId] = { key, dir };

  const cached = rowCache[bodyId];
  if (!cached) return;
  const { rows, cols, isCollege } = cached;

  const thead = document.getElementById(headId);
  const tbody = document.getElementById(bodyId);
  thead.innerHTML = buildHead(headId, bodyId, cols, isCollege, key, dir);
  tbody.innerHTML = buildRows(sortRows(rows, key, dir), cols, isCollege);
});

// ── Event delegation for filter buttons (avoids WordPress stripping onclick) ──
document.addEventListener('click', function(e) {
  const btn = e.target.closest('.filter-btn');
  if (!btn) return;
  const bar = btn.closest('.filter-bar');
  if (!bar) return;
  const section = bar.id === 'collegeFilters' ? 'college' : 'pro';
  const filter  = btn.dataset.filter;
  filterTable(section, filter, btn);
});

loadData();
</script>

</body>
</html>
